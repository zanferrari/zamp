<html>
<HTA:APPLICATION  
MAXIMIZEBUTTON="no"   
ICON="Winver.exe"  
SCROLL="No"  
SCROLLFLAT="yes"  
SINGLEINSTANCE="yes"    
CONTEXTMENU="no"  
SELECTION="no"/> 
<style Type="text/css">
body {
	font-size:15pt;
	font-family: Calibri, Arial, Tahoma, Segoe Ui, Comic Sans MS;
	background-color: #eaecee
}
.running {
	background-color: green;
	color: white;
	padding: 5px
}
.stopped {
	background-color: red;
	color: white;
	padding: 5px
}
.btn {
	border: 0;
	background: none;
	box-shadow: none;
	border-radius: 0px;
	color: white;
	background-color: #097969;
	padding: 4px;
	margin: 5px 2px
}
.btn_red {
	background-color: #C70039
}
</style>
<head>
<title>Zanfi | Start and stop ZAMP</title>
<script Language="VBScript">
Set objShell = CreateObject("Wscript.Shell")
strPath = objShell.CurrentDirectory

dim filesys, filetxt, path
Set filesys = CreateObject("Scripting.FileSystemObject")
Set filetxt = filesys.CreateTextFile("extra-apache24.conf", True)
path = filesys.GetAbsolutePathName("extra-apache24.conf")
filetxt.WriteLine("Define STATIC_PATH """ & strPath & """")
filetxt.Close

'*******************************************
Sub Window_OnLoad
    CenterWindow 450,270
	chk_process_apache()
	chk_process_mysql()
	refresh()
End Sub
'*******************************************
Sub CenterWindow(x,y)
    window.resizeTo x, y
    iLeft = window.screen.availWidth/2 - x/2
    itop = window.screen.availHeight/2 - y/2
    window.moveTo ileft, itop
End Sub
'*******************************************
Sub mysql_start()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\mariadb\bin\mysqld.exe",0 
	
	Set oShell = Nothing
	
	Call DisableButton3()
	
	Delay(2)
	
	chk_process_mysql()

End Sub
'*******************************************
Sub mysql_stop()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run "taskkill /im mysqld.exe /t /f",0 
	
	Set oShell = Nothing
	
	Call DisableButton4()
	
	Delay(2)
	
	chk_process_mysql()

End Sub
'*******************************************
Sub apache_start7()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\Apache24\bin\httpd.exe -D php7",0
	
	Set oShell = Nothing
	
	Call DisableButton1()
	Call DisableButton5()
	
	Delay(2)
	
	chk_process_apache()

End Sub
'*******************************************
Sub apache_start8()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\Apache24\bin\httpd.exe -D php8",0
	
	Set oShell = Nothing
	
	Call DisableButton5()
	Call DisableButton1()
	
	Delay(2)
	
	chk_process_apache()

End Sub
'*******************************************
Sub apache_stop()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run "taskkill /im httpd.exe /t /f",0 
	
	Set oShell = Nothing
	
	Call DisableButton2()
	
	Delay(2)
	
	chk_process_apache()

End Sub
'*******************************************
Sub chk_process_apache()

	Dim i
	Dim strComputer
	Dim FindProc
	 
	strComputer = "."

	FindProc = "httpd.exe"

	Set objWMIService = GetObject("winmgmts:" _
		& "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
	Set colProcessList = objWMIService.ExecQuery _
		("Select Name from Win32_Process WHERE Name LIKE '" & FindProc & "%'")

	If colProcessList.count>0 then
		httpd.InnerHTML = "<font class='running'>Apache running</font>"
		DisableButton1()
	else
		httpd.InnerHTML = "<font class='stopped'>Apache stopped</font>"
		DisableButton2()
	End if

	Set objWMIService = Nothing
	Set colProcessList = Nothing

End Sub
'*******************************************
Sub chk_process_mysql()

	Dim i
	Dim strComputer
	Dim FindProc
	 
	strComputer = "."

	FindProc = "mysqld.exe"

	Set objWMIService = GetObject("winmgmts:" _
		& "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
	Set colProcessList = objWMIService.ExecQuery _
		("Select Name from Win32_Process WHERE Name LIKE '" & FindProc & "%'")

	If colProcessList.count>0 then
		mysql.InnerHTML = "<span  class='running'>Mysql running</span>"
		DisableButton3()
	else
		mysql.InnerHTML = "<span  class='stopped'>Mysql stopped</span>"
		DisableButton4()
	End if

	Set objWMIService = Nothing
	Set colProcessList = Nothing

End Sub
'*******************************************
Sub refresh()
   Do While 1 = 1
	Delay(10)
	chk_process_apache()
	chk_process_mysql()
   Loop
End Sub
'******************************************
Sub DisableButton1()
    button1.disabled = True
    button2.disabled = False
End Sub
'******************************************
Sub DisableButton2()
    button2.disabled = True
    button1.disabled = False
	button5.disabled = False
End Sub
'******************************************
Sub DisableButton3()
    button3.disabled = True
    button4.disabled = False
End Sub
'******************************************
Sub DisableButton4()
    button4.disabled = True
    button3.disabled = False
End Sub
'******************************************
Sub DisableButton5()
    button5.disabled = True
    button3.disabled = False
End Sub
'******************************************
Sub Delay( seconds )
	Dim wshShell, strCmd
	Set wshShell = CreateObject( "WScript.Shell" )
	strCmd = wshShell.ExpandEnvironmentStrings( "%COMSPEC% /C (PING.EXE -n " & ( seconds + 1 ) & " localhost >NUL 2>&1)" )
	wshShell.Run strCmd, 0, 1
	Set wshShell = Nothing
End Sub
</script>
</head>
<body>
<hr>
<center>
	<input type="button" name="button1" value="Start Apache (Php 7)" onclick="apache_start7()" class="btn">
	<input type="button" name="button5" value="Start Apache (Php 8)" onclick="apache_start8()" class="btn">
	<input type="button" name="button2" value="Stop Apache" onclick="apache_stop()" class="btn btn_red">
	<hr>
	<input type="button" name="button3" value="Start Mysql" onclick="mysql_start()" class="btn">
	<input type="button" name="button4" value="Stop Mysql" onclick="mysql_stop()" class="btn btn_red">
	<hr>
	<span id ="httpd"></span>&nbsp;&nbsp;<span id ="mysql"></span> 
<center>
</body>
</html>