<html>
<HTA:APPLICATION  
MAXIMIZEBUTTON="no"   
ICON="Winver.exe"  
SCROLL="No"  
SCROLLFLAT="yes"  
SINGLEINSTANCE="yes"    
CONTEXTMENU="no"  
SELECTION="no"/> 
<style Type="text/css">
body {
	font-size:13pt;
	font-family: Calibri, Arial, Tahoma, Segoe Ui, Comic Sans MS;
	background-color: #eaecee
}
.running {
	color: green;
	padding: 2px
}
.stopped {
	color: red;
	padding: 2px
}
.btn {
	border: 0;
	background: none;
	box-shadow: none;
	border-radius: 0px;
	color: white;
	background-color: #097969;
	padding: 4px;
	margin: 5px 2px
}
.btn_red {
	background-color: #C70039
}
</style>
<head>
<title>Zanfi | Start and stop ZAMP</title>
<meta http-equiv="x-ua-compatible" content="ie=9" />
<script Language="VBScript">
'************ folders of the 2 php versions **********
php8 = "php8"
php8_2 = "php8_2"

Set objShell = CreateObject("Wscript.Shell")
strPath = objShell.CurrentDirectory

'************ add runtime paths to environment **********
'************ avoid failing loading modules *****
strPathAdd = strPath & "\" & php8
strPathAdd1 = strPath & "\" & php8_2

Sub Upd_Path_Ini(php_ver)

	Const ForReading = 1
	Const ForWriting = 2

	' Specify the path to the file you want to modify
	filePath = strPath & "\" & php_ver & "\php-skeleton.ini"
	' ini file with modified extenion_dir
	destinationFilePath = strPath & "\" & php_ver & "\php.ini"

	' Specify the string you want to find and the replacement string
	stringToFind = "@ext@"
	replacementString = strPath & "\" & php_ver & "\ext"

	Set objFSO = CreateObject("Scripting.FileSystemObject")

	' Check if the file exists
	If objFSO.FileExists(filePath) Then
		' Read the file
		Set objFile = objFSO.OpenTextFile(filePath, ForReading, False)
		fileContent = objFile.ReadAll
		objFile.Close

		' Replace the string
		fileContent = Replace(fileContent, stringToFind, replacementString)

	Else
		MsgBox("File read not found: " & filePath)
	End If

	If objFSO.FileExists(destinationFilePath) Then
		' Write the modified content back to the ini file
		Set objFile = objFSO.OpenTextFile(destinationFilePath, ForWriting, True)
		objFile.Write fileContent
		objFile.Close
	Else
		MsgBox("File write not found: " & filePath)
	End If

End Sub

Sub Set_Path(php_ver)
Exit Sub
	Set objEnv = objShell.Environment("USER")

	objEnv("PATH") = Replace(objEnv("PATH"), strPathAdd1, "")
	objEnv("PATH") = Replace(objEnv("PATH"), strPathAdd, "")

	objEnv("PATH") = objEnv("PATH") & ";" & strPath & "\" & php_ver

	' Create a Shell object
	Set WshShell = CreateObject("WScript.Shell")

	' Specify the new PATH value
	newPath = strPath & "\" & php_ver & ";"
	newPathExt = "" & chr(34) & strPath & "\" & php_ver & "\ext" & chr(34) & ""

	' Use setx to update the PATH variable and make it immediately available
	WshShell.Run "cmd /C setx PATH """ & newPath & """ /M", 0, True

	' Clean up
	Set WshShell = Nothing

End Sub

'************* static path Apache **********
dim filesys, filetxt, path
Set filesys = CreateObject("Scripting.FileSystemObject")
Set filetxt = filesys.CreateTextFile("extra-apache24.conf", True)
path = filesys.GetAbsolutePathName("extra-apache24.conf")
filetxt.WriteLine("Define STATIC_PATH """ & strPath & """")
filetxt.WriteLine("php_admin_value sendmail_path """ & strPath & "\sendmail\sendmail.exe""")
filetxt.Close

'************* static path Mariadb *********
dim filesys1, filetxt1, path1
Set filesys1 = CreateObject("Scripting.FileSystemObject")
Set filetxt1 = filesys1.CreateTextFile("extra-my.conf", True)
path1 = filesys1.GetAbsolutePathName("extra-my.conf")
filetxt1.WriteLine("[mysqld]")
filetxt1.WriteLine("datadir = " & strPath & "\mariadb\data")
filetxt1.WriteLine("plugin-dir = " & strPath & "\mariadb/lib/plugin")
filetxt1.WriteLine("innodb_data_home_dir = " & strPath & "\mariadb\data")
filetxt1.WriteLine("innodb_data_file_path = ibdata1:12M:autoextend")
filetxt1.WriteLine("innodb_log_group_home_dir = " & strPath & "\mariadb\data")
filetxt1.WriteLine("query_cache_size = 16M")
filetxt1.Close

'*******************************************
Sub window_onload
    CenterWindow 430,200
	chk_process_apache()
	chk_process_mysql()
	refresh()
End Sub
'*******************************************
Sub CenterWindow(x,y)
    window.resizeTo x, y
    iLeft = window.screen.availWidth/2 - x/2
    itop = window.screen.availHeight/2 - y/2
    window.moveTo ileft, itop
End Sub
'*******************************************
Sub mysql_start()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\mariadb\bin\mysqld.exe",0 
	
	Set oShell = Nothing
	
	Call DisableButton3()
	
	Delay(1)
	
	chk_process_mysql()

End Sub
'*******************************************
Sub mysql_stop()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run "taskkill /im mysqld.exe /t /f",0 
	
	Set oShell = Nothing
	
	Call DisableButton4()
	
	Delay(1)
	
	chk_process_mysql()

End Sub
'*******************************************
Sub apache_start82()

	Set_Path(php8_2)

	'''' UPDATE extension PATH in php.ini

	Upd_Path_Ini(php8_2)
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\Apache24\bin\httpd.exe -D " & php8_2,0
	
	Set oShell = Nothing
	
	Call DisableButton1()
	Call DisableButton5()
	
	Delay(1)
	
	chk_process_apache()

End Sub
'*******************************************
Sub apache_start8()
	
	Set_Path(php8)

	'''' UPDATE extension PATH in php.ini

	Upd_Path_Ini(php8)

	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run strPath & "\Apache24\bin\httpd.exe -D " & php8,0
	
	Set oShell = Nothing
	
	Call DisableButton5()
	Call DisableButton1()
	
	Delay(1)
	
	chk_process_apache()

End Sub
'*******************************************
Sub apache_stop()
	
	Set oShell = CreateObject ("WScript.Shell")
	
	oShell.run "taskkill /im httpd.exe /t /f",0 

	Set oShell = Nothing
	
	DisableButton2()
	
	Delay(1)
	
	chk_process_apache()

	'window.close()

End Sub
'*******************************************
Sub chk_process_apache()

	Dim i
	Dim strComputer
	Dim FindProc
	 
	strComputer = "."

	FindProc = "httpd.exe"

	Set objWMIService = GetObject("winmgmts:" _
		& "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
	Set colProcessList = objWMIService.ExecQuery _
		("Select Name from Win32_Process WHERE Name LIKE '" & FindProc & "%'")

	If colProcessList.count>0 then
		httpd.InnerHTML = "<font class='running'>Apache running</font>"
		DisableButton1()
	else
		httpd.InnerHTML = "<font class='stopped'>Apache stopped</font>"
		DisableButton2()
	End if

	Set objWMIService = Nothing
	Set colProcessList = Nothing

End Sub
'*******************************************
Sub chk_process_mysql()

	Dim i
	Dim strComputer
	Dim FindProc
	 
	strComputer = "."

	FindProc = "mysqld.exe"

	Set objWMIService = GetObject("winmgmts:" _
		& "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
	Set colProcessList = objWMIService.ExecQuery _
		("Select Name from Win32_Process WHERE Name LIKE '" & FindProc & "%'")

	If colProcessList.count>0 then
		mysql.InnerHTML = "<span  class='running'>Mysql running</span>"
		DisableButton3()
	else
		mysql.InnerHTML = "<span  class='stopped'>Mysql stopped</span>"
		DisableButton4()
	End if

	Set objWMIService = Nothing
	Set colProcessList = Nothing

End Sub
'*******************************************
Sub refresh()
   Do While 1 = 1
	Delay(10)
	chk_process_apache()
	chk_process_mysql()
   Loop
End Sub
'******************************************
Sub DisableButton1()
    button1.disabled = True
    button2.disabled = False
	span2.style.display = "block"
	span1.style.display = "none"
	span5.style.display = "none"
End Sub
'******************************************
Sub DisableButton2()
    button2.disabled = True
	span2.style.display = "none"
	span1.style.display = "inline-block"
	span5.style.display = "inline-block"
    button1.disabled = False
	button5.disabled = False
End Sub
'******************************************
Sub DisableButton3()
    button3.disabled = True
    button4.disabled = False
	span4.style.display = "block"
	span3.style.display = "none"
End Sub
'******************************************
Sub DisableButton4()
    button4.disabled = True
	span4.style.display = "none"
	span3.style.display = "block"
    button3.disabled = False
End Sub
'******************************************
Sub DisableButton5()
    button5.disabled = True
    button3.disabled = False
End Sub
'******************************************
Sub Delay( seconds )
	Dim wshShell, strCmd
	Set wshShell = CreateObject( "WScript.Shell" )
	strCmd = wshShell.ExpandEnvironmentStrings( "%COMSPEC% /C (PING.EXE -n " & ( seconds + 1 ) & " localhost >NUL 2>&1)" )
	wshShell.Run strCmd, 0, 1
	Set wshShell = Nothing
End Sub
</script>
</head>
<body>
<center>
	<span id="span1"><input type="button" name="button1" value="Start Apache with Php 8.2" onclick="vbscript:apache_start82()" class="btn"></span>
	<span id="span5"><input type="button" name="button5" value="Start Apache with Php 8" onclick="vbscript:apache_start8()" class="btn"></span>
	<span id="span2"><input type="button" name="button2" value="Stop Apache" onclick="vbscript:apache_stop()" class="btn btn_red"></span>
	<hr>
	<span id="span3"><input type="button" name="button3" value="Start Mysql" onclick="vbscript:mysql_start()" class="btn"></span>
	<span id="span4"><input type="button" name="button4" value="Stop Mysql" onclick="vbscript:mysql_stop()" class="btn btn_red"></span>
	<hr>
	Services status: <span id ="httpd"></span>&nbsp;-&nbsp;<span id ="mysql"></span> 
<center>
</body>
</html>